

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pynta.io &mdash; Pynta February 19, 2021 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Pynta
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Pynta</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../pynta.html">pynta</a> &raquo;</li>
        
      <li>pynta.io</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pynta.io</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span><span class="p">,</span> <span class="n">PosixPath</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="kn">from</span> <span class="nn">pynta.excatkit.molecule</span> <span class="kn">import</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">pynta.excatkit.gratoms</span> <span class="kn">import</span> <span class="n">Gratoms</span>
<span class="kn">from</span> <span class="nn">pynta.graph_utils</span> <span class="kn">import</span> <span class="n">node_test</span>

<span class="kn">from</span> <span class="nn">ase.io</span> <span class="kn">import</span> <span class="n">read</span><span class="p">,</span> <span class="n">write</span>
<span class="kn">from</span> <span class="nn">ase.dft.kpoints</span> <span class="kn">import</span> <span class="n">monkhorst_pack</span>
<span class="kn">from</span> <span class="nn">ase.utils.structure_comparator</span> <span class="kn">import</span> <span class="n">SymmetryEquivalenceCheck</span>
<span class="kn">from</span> <span class="nn">ase.io.formats</span> <span class="kn">import</span> <span class="n">UnknownFileTypeError</span>


<div class="viewcode-block" id="IO"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO">[docs]</a><span class="k">class</span> <span class="nc">IO</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39; Class for handling Input/Output and transforming it to more usefull</span>
<span class="sd">    format for the pynta &#39;&#39;&#39;</span>

<div class="viewcode-block" id="IO.get_facetpath"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_facetpath">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_facetpath</span><span class="p">(</span>
            <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">surface_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39; Get a facetpath for a given surface defined by a</span>
<span class="sd">        symbol and a surface_type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        symbol : str</span>
<span class="sd">            atomic symbol of the studied metal surface</span>
<span class="sd">            e.g. ``&#39;Cu&#39;``</span>
<span class="sd">        surface_type : str</span>
<span class="sd">            type of the surface, i.e. facet.</span>
<span class="sd">            e.g. ``&#39;fcc111&#39;``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        facetpath : str</span>
<span class="sd">            a name of the facetpath,</span>
<span class="sd">            eg. ``&#39;Cu_111&#39;``</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nums</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">surface_type</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">facet</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
        <span class="n">facetpath</span> <span class="o">=</span> <span class="n">symbol</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">facet</span>
        <span class="k">return</span> <span class="n">facetpath</span></div>

<div class="viewcode-block" id="IO.get_facetpaths"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_facetpaths">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_facetpaths</span><span class="p">(</span>
            <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">surface_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; Generate a list with all facetpaths for a given surface defined by</span>
<span class="sd">        a symbol and a surface_type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        symbol : str</span>
<span class="sd">            atomic symbol of the studied metal surface</span>
<span class="sd">            e.g. ``&#39;Cu&#39;``</span>
<span class="sd">        surface_types : List[str]</span>
<span class="sd">            a list with all surface types, i.e. facets.</span>
<span class="sd">            e.g.</span>

<span class="sd">            &gt;&gt;&gt; surface_types = [&#39;fcc111&#39;, &#39;fcc100&#39;]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        facetpaths : List[str]</span>
<span class="sd">            a list with all facetpath names,</span>
<span class="sd">            e.g.</span>

<span class="sd">            &gt;&gt;&gt; facetpaths = [&#39;Cu_111&#39;, &#39;Cu_100&#39;]</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">facetpaths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stype</span> <span class="ow">in</span> <span class="n">surface_types</span><span class="p">:</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">stype</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="n">facet</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
            <span class="n">facetpath</span> <span class="o">=</span> <span class="n">symbol</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">facet</span>
            <span class="n">facetpaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facetpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">facetpaths</span></div>

<div class="viewcode-block" id="IO.get_kpoints"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_kpoints">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_kpoints</span><span class="p">(</span>
            <span class="n">size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">get_uniq_kpts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
        <span class="sd">&#39;&#39;&#39; Returns number of unique k-points for a given size of the slab</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : Tuple[int, int, int]</span>
<span class="sd">            a size or repeats of the slab,</span>
<span class="sd">            e.g.</span>

<span class="sd">            &gt;&gt;&gt; size = (3, 3, 1)</span>

<span class="sd">        get_uniq_kpts : bool, optional</span>
<span class="sd">            If True, return size and an ndarray of unique kpoints</span>
<span class="sd">            Otherwise False. By default False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        m_uniq_kpts : int</span>
<span class="sd">            a number of unique k-points</span>
<span class="sd">        uniq : ndarray</span>
<span class="sd">            an array with unique k-points, optional</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">kpts</span> <span class="o">=</span> <span class="n">monkhorst_pack</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">half_kpts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kpts</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">uniq</span> <span class="o">=</span> <span class="n">kpts</span><span class="p">[</span><span class="n">half_kpts</span><span class="p">:,</span> <span class="p">]</span>
        <span class="n">m_uniq_kpts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">m_uniq_kpts</span><span class="p">,</span> <span class="n">uniq</span><span class="p">)</span> <span class="k">if</span> <span class="n">get_uniq_kpts</span> <span class="k">else</span> <span class="n">m_uniq_kpts</span></div>

<div class="viewcode-block" id="IO.get_species_dict"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_species_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_species_dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">yamlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&#39;&#39;&#39; For a given reaction get a dictionary with all species that takes</span>
<span class="sd">        part in the reaction.</span>

<span class="sd">        Those species will be considered as a reacting species by the</span>
<span class="sd">        TS esitmate constructor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yamlfile : str</span>
<span class="sd">            a name of the :literal:`*.yaml` file with a reaction list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        species_dict : Dict[str, List[str]]</span>
<span class="sd">            a dictionary where keys are reactions (in a rxn{#} format)</span>
<span class="sd">            and values are species considered to moved in that reaction</span>
<span class="sd">            e.g.</span>

<span class="sd">            &gt;&gt;&gt; species_dict = {&#39;rxn1&#39;: [&#39;O&#39;, &#39;H&#39;], &#39;rxn2&#39;: [&#39;C&#39;, &#39;H&#39;]}</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">species_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">reactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_yaml_file</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reactions</span><span class="p">):</span>
            <span class="n">r_name_list</span><span class="p">,</span> <span class="n">p_name_list</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_reactants_and_products</span><span class="p">(</span>
                <span class="n">rxn</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_name_list</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_name_list</span><span class="p">):</span>
                <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rxn</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">r_name_list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">species_dict</span><span class="p">[</span><span class="s1">&#39;rxn</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">p_name_list</span>
        <span class="k">return</span> <span class="n">species_dict</span></div>

<div class="viewcode-block" id="IO.open_yaml_file"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.open_yaml_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">open_yaml_file</span><span class="p">(</span>
            <span class="n">yamlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&#39;&#39;&#39; Open yaml file with list of reactions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yamlfile : str</span>
<span class="sd">            a name of the .yaml file with a reaction list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------__</span>
<span class="sd">        reactions : List[Dict[str,str]]</span>
<span class="sd">            a list with each reaction details stored as a dictionary</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yamltxt</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">reactions</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yamltxt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reactions</span></div>

<div class="viewcode-block" id="IO.get_all_unique_species_symbols"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_all_unique_species_symbols">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_all_unique_species_symbols</span><span class="p">(</span>
            <span class="n">yamlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; Generate a list with all unique species names</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yamlfile : str</span>
<span class="sd">            a name of the :literal:`*.yaml` file with a reaction list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        all_species : List[str]</span>
<span class="sd">            a list with all unique species names in all reactions</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">reactions</span> <span class="o">=</span> <span class="n">IO</span><span class="p">()</span><span class="o">.</span><span class="n">open_yaml_file</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">)</span>

        <span class="n">all_sp_tmp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">reactions</span><span class="p">:</span>
            <span class="n">reactants_rxn</span><span class="p">,</span> <span class="n">products_rxn</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_reactants_and_products</span><span class="p">(</span>
                <span class="n">rxn</span><span class="p">)</span>
            <span class="n">all_sp_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reactants_rxn</span><span class="p">)</span>
            <span class="n">all_sp_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">products_rxn</span><span class="p">)</span>

        <span class="n">all_species</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">species</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_sp_tmp</span> <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="c1"># remove empty elements, such as &#39;&#39;</span>
        <span class="n">all_species</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span> <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">all_species</span> <span class="k">if</span> <span class="n">species</span><span class="p">]</span>

        <span class="c1"># remove duplicates keeping order - dictionary would do the job</span>
        <span class="n">all_unique_species</span> <span class="o">=</span> <span class="p">{</span><span class="n">species</span><span class="p">:</span> <span class="kc">True</span> <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">all_species</span><span class="p">}</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_unique_species</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="IO.get_reactants_and_products"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_reactants_and_products">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_reactants_and_products</span><span class="p">(</span>
            <span class="n">rxn</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&#39;&#39;&#39; For a given rxn, get lists with all reactants and products</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rxn : Dict[str,str]</span>
<span class="sd">            a dictionary with info about the paricular reaction. This can be</span>
<span class="sd">            view as a splitted many reaction :literal:`*.yaml` file to a</span>
<span class="sd">            single reaction :literal:`*.yaml` file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[List[str], List[str]]</span>
<span class="sd">            lists with species names for reactants and products</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">raw_rxn_name</span> <span class="o">=</span> <span class="n">rxn</span><span class="p">[</span><span class="s1">&#39;reaction&#39;</span><span class="p">]</span>
        <span class="n">raw_products</span><span class="p">,</span> <span class="n">raw_reactants</span> <span class="o">=</span> <span class="n">raw_rxn_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&lt;=&gt;&#39;</span><span class="p">)</span>

        <span class="n">tmp_reactants</span> <span class="o">=</span> <span class="p">[</span><span class="n">react</span><span class="p">[:</span><span class="n">react</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                         <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">react</span> <span class="k">else</span>
                         <span class="n">react</span><span class="p">[:</span><span class="n">react</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                         <span class="k">for</span> <span class="n">react</span> <span class="ow">in</span> <span class="n">raw_reactants</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)]</span>

        <span class="n">tmp_products</span> <span class="o">=</span> <span class="p">[</span><span class="n">prod</span><span class="p">[:</span><span class="n">prod</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">prod</span> <span class="k">else</span>
                        <span class="n">prod</span><span class="p">[:</span><span class="n">prod</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">raw_products</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)]</span>

        <span class="c1"># remove all &#39;X&#39; species</span>
        <span class="n">r_x_removed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">((</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">,</span> <span class="n">tmp_reactants</span><span class="p">))</span>
        <span class="n">p_x_removed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">((</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">,</span> <span class="n">tmp_products</span><span class="p">))</span>

        <span class="c1"># remove all empty &#39;&#39; elements</span>
        <span class="n">reactants</span> <span class="o">=</span> <span class="p">[</span><span class="n">react</span> <span class="k">for</span> <span class="n">react</span> <span class="ow">in</span> <span class="n">p_x_removed</span> <span class="k">if</span> <span class="n">react</span><span class="p">]</span>
        <span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="n">prod</span> <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">r_x_removed</span> <span class="k">if</span> <span class="n">prod</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">reactants</span><span class="p">,</span> <span class="n">products</span></div>

<div class="viewcode-block" id="IO.get_rxn_name"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_rxn_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_rxn_name</span><span class="p">(</span>
            <span class="n">rxn</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39; Get a reaction name for a given rxn</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rxn : Dict[str,str]</span>
<span class="sd">            a dictionary with info about the paricular reaction. This can be</span>
<span class="sd">            view as a splitted many reaction :literal:`*.yaml` file to a</span>
<span class="sd">            single reaction :literal:`*.yaml` file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rxn_name: str</span>
<span class="sd">            a reaction name,</span>
<span class="sd">            e.g. ``&#39;CO_C+O&#39;``</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">reactants</span><span class="p">,</span> <span class="n">products</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_reactants_and_products</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span>
        <span class="n">rxn_name</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">reactants</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;+&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rxn_name</span></div>

<div class="viewcode-block" id="IO.get_xyz_from_traj"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_xyz_from_traj">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_xyz_from_traj</span><span class="p">(</span>
            <span class="n">path_to_species</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39; Convert all ASE&#39;s traj files to .xyz files for a given species</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path_to_minima : str</span>
<span class="sd">            a path to minima</span>
<span class="sd">            e.g. ``&#39;Cu_111/minima&#39;``</span>
<span class="sd">        species : str</span>
<span class="sd">            a species symbol</span>
<span class="sd">            e.g. ``&#39;H&#39;`` or ``&#39;CO&#39;``</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_to_species</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">traj</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.traj&#39;</span><span class="p">):</span>
                <span class="n">src_traj_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_species</span><span class="p">,</span> <span class="n">traj</span><span class="p">)</span>
                <span class="n">des_traj_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">path_to_species</span><span class="p">,</span> <span class="n">traj</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_final.xyz&#39;</span><span class="p">)</span>
                <span class="n">write</span><span class="p">(</span><span class="n">des_traj_path</span><span class="p">,</span> <span class="n">read</span><span class="p">(</span><span class="n">src_traj_path</span><span class="p">))</span></div>

<div class="viewcode-block" id="IO.depends_on"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.depends_on">[docs]</a>    <span class="k">def</span> <span class="nf">depends_on</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">facetpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">yamlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">creation_dir</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&#39;&#39;&#39; Returns a dictionary of adsorbate + surface calculations</span>
<span class="sd">        (step 01; :literal:`*.py` files) that has to be finished before</span>
<span class="sd">        starting step 02 for a particular reaction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        facetpath : str</span>
<span class="sd">            a path to the workflow&#39;s main dir</span>
<span class="sd">            e.g. ``&#39;Cu_111&#39;``</span>
<span class="sd">        yamlfile : str</span>
<span class="sd">            a name of the .yaml file with a reaction list</span>
<span class="sd">        creation_dir : str</span>
<span class="sd">            a path to the main working directory</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        dependancy_dict : [str:List[str]]</span>
<span class="sd">            a dictionary with keys being reaction names and values are lists</span>
<span class="sd">            of :literal:`*.py` files for step 01 that have to be finished to</span>
<span class="sd">            start 02 step for a given reaction</span>
<span class="sd">            e.g.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">path_to_minima</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">creation_dir</span><span class="p">,</span> <span class="n">facetpath</span><span class="p">,</span> <span class="s1">&#39;minima&#39;</span><span class="p">)</span>
        <span class="n">path_to_yamlfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">creation_dir</span><span class="p">,</span> <span class="n">yamlfile</span><span class="p">)</span>

        <span class="c1"># get reactions from. .yaml file</span>
        <span class="n">reactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_yaml_file</span><span class="p">(</span><span class="n">path_to_yamlfile</span><span class="p">)</span>

        <span class="n">dependancy_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># loop through all reactions</span>
        <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">reactions</span><span class="p">:</span>
            <span class="c1"># get list of reactant and product</span>
            <span class="n">reactants</span><span class="p">,</span> <span class="n">products</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_reactants_and_products</span><span class="p">(</span>
                <span class="n">rxn</span><span class="p">)</span>
            <span class="c1"># get reaction name</span>
            <span class="n">rxn_name</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_rxn_name</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span>
            <span class="n">minima_py_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># loop through all reactants</span>
            <span class="k">for</span> <span class="n">reactant</span> <span class="ow">in</span> <span class="n">reactants</span><span class="p">:</span>
                <span class="c1"># I have no idea why OH and HO is getting reverse</span>
                <span class="c1"># a workaround</span>
                <span class="n">lookup_phrase</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_*relax.py&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">facetpath</span><span class="p">,</span> <span class="n">reactant</span><span class="p">)</span>
                <span class="c1"># find matching reatants</span>
                <span class="n">minima_py_files</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_to_minima</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">lookup_phrase</span><span class="p">)</span>
                <span class="c1"># append a list with minima that have to be calculated during</span>
                <span class="c1"># run_02 step</span>
                <span class="k">for</span> <span class="n">minima_py_file</span> <span class="ow">in</span> <span class="n">minima_py_files</span><span class="p">:</span>
                    <span class="n">minima_py_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">minima_py_file</span><span class="p">)))[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># loop through all products and do the same as for reactants</span>
            <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
                <span class="n">lookup_phrase</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_*relax.py&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">facetpath</span><span class="p">,</span> <span class="n">product</span><span class="p">)</span>
                <span class="n">minima_py_files</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_to_minima</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">lookup_phrase</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">minima_py_file</span> <span class="ow">in</span> <span class="n">minima_py_files</span><span class="p">:</span>
                    <span class="n">minima_py_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">minima_py_file</span><span class="p">)))[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># create a dictionary with dependencies</span>
            <span class="n">dependancy_dict</span><span class="p">[</span><span class="n">rxn_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">minima_py_list</span>
        <span class="k">return</span> <span class="n">dependancy_dict</span></div>

<div class="viewcode-block" id="IO.clean_finished_subjobs"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.clean_finished_subjobs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">clean_finished_subjobs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39; Move finished subjob files to finished_tmp_scripts directory &#39;&#39;&#39;</span>
        <span class="n">dir_name</span> <span class="o">=</span> <span class="s1">&#39;finished_tmp_scripts&#39;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">keyphrase</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;*out&#39;</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">keyphrase</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># move all not empty .out files</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
                    <span class="c1"># and corresponding .py.out files</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span> <span class="n">dir_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="IO.get_unique_adsorbates_prefixes"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_unique_adsorbates_prefixes">[docs]</a>    <span class="k">def</span> <span class="nf">get_unique_adsorbates_prefixes</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">facetpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">yamlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">creation_dir</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&#39;&#39;&#39; Get a dictionary with a list with prefixes of symmetry distinct</span>
<span class="sd">        conformers for a given adsorbate</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        facetpath : str</span>
<span class="sd">            a name of the facetpath,</span>
<span class="sd">            eg. ``&#39;Cu_111&#39;``</span>
<span class="sd">        yamlfile : str</span>
<span class="sd">            a name of the :literal:`*.yaml` file with a reaction list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        unique_adsorbates_prefixes: Dict[str, List[str]]</span>
<span class="sd">            a dictionary with a list with prefixes of symmetry distinct</span>
<span class="sd">            conformers for a given adsorbate</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">unique_adsorbates_prefixes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">path_to_minima</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">creation_dir</span><span class="p">,</span> <span class="n">facetpath</span><span class="p">,</span> <span class="s1">&#39;minima&#39;</span><span class="p">)</span>
        <span class="n">all_species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_unique_species</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">all_species</span><span class="p">:</span>
            <span class="n">path_to_species</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_minima</span><span class="p">,</span> <span class="n">species</span><span class="p">)</span>
            <span class="n">uq_prefixes</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_unique_prefixes</span><span class="p">(</span>
                <span class="n">path_to_species</span><span class="p">)</span>
            <span class="n">unique_adsorbates_prefixes</span><span class="p">[</span><span class="n">species</span><span class="p">]</span> <span class="o">=</span> <span class="n">uq_prefixes</span>
        <span class="k">return</span> <span class="n">unique_adsorbates_prefixes</span></div>

<div class="viewcode-block" id="IO.get_unique_prefixes"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_unique_prefixes">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_unique_prefixes</span><span class="p">(</span>
            <span class="n">path_to_species</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; Compare each conformers for a given adsorbate and returns a list</span>
<span class="sd">        with prefixes of a symmetrty dictinct structures</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path_to_species : str</span>
<span class="sd">            a path to species</span>
<span class="sd">            e.g. ``&#39;Cu_111/minima/CO&#39;``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        unique_minima_prefixes : List[str]</span>
<span class="sd">            a list with prefixes of symmetry distinct structures for a given</span>
<span class="sd">            adsorbate</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">good_minima</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">unique_minima_prefixes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">trajlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path_to_species</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*traj&#39;</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="n">trajlist</span><span class="p">:</span>
            <span class="n">minima</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>
            <span class="n">comparator</span> <span class="o">=</span> <span class="n">SymmetryEquivalenceCheck</span><span class="p">(</span><span class="n">to_primitive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">comparator</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">minima</span><span class="p">,</span> <span class="n">good_minima</span><span class="p">)</span>
            <span class="n">result_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">good_minima</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minima</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">result_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">unique_minima_prefixes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unique_minima_prefixes</span></div>

<div class="viewcode-block" id="IO.get_unique_final_ts_prefixes"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_unique_final_ts_prefixes">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_unique_final_ts_prefixes</span><span class="p">(</span>
            <span class="n">path_to_ts</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; Compare each conformers for a given adsorbate and returns a list</span>
<span class="sd">        with prefixes of a symmetrty dictinct structures</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path_to_species : str</span>
<span class="sd">            a path to species</span>
<span class="sd">            e.g. ``&#39;Cu_111/minima/CO&#39;``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        unique_minima_prefixes : List[str]</span>
<span class="sd">            a list with prefixes of symmetry distinct structures for a given</span>
<span class="sd">            adsorbate</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">unique_ts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">unique_ts_prefixes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">trajlist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path_to_ts</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;**/*traj&#39;</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="n">trajlist</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>
                <span class="n">comparator</span> <span class="o">=</span> <span class="n">SymmetryEquivalenceCheck</span><span class="p">(</span><span class="n">to_primitive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">comparator</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">unique_ts</span><span class="p">)</span>
                <span class="n">result_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">traj</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">result</span>
                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">unique_ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
            <span class="c1"># error handling while calculations are still running/unfinished</span>
            <span class="k">except</span> <span class="n">UnknownFileTypeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">result_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">unique_ts_prefixes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unique_ts_prefixes</span></div>

<div class="viewcode-block" id="IO.get_list_all_rxns_names"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_list_all_rxns_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_list_all_rxns_names</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">yamlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; Get a list with all reactions names</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yamlfile : str</span>
<span class="sd">            a name of the :literal:`*.yaml` file with a reaction list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        all_rxns : List[str]</span>
<span class="sd">            a list with all reactions names</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># open .yaml file</span>
        <span class="n">reactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_yaml_file</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">)</span>

        <span class="n">all_rxns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">reactions</span><span class="p">:</span>
            <span class="n">rxn_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rxn_name</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span>
            <span class="n">all_rxns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rxn_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_rxns</span></div>

<div class="viewcode-block" id="IO.get_all_reacting_atoms"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_all_reacting_atoms">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_all_reacting_atoms</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
        <span class="sd">&#39;&#39;&#39; Read a :literal:`*.yaml` file with all reactions and extract</span>
<span class="sd">        reacting atoms symbols and indicies - the one with asterisk in the</span>
<span class="sd">        :literal:`*.yaml` file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yamlfile : str</span>
<span class="sd">            a name of the :literal:`*.yaml` file with a reaction list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dict[str, Dict[str, float]]</span>
<span class="sd">            a dictionary with keys are &#39;rxn_1, rxn_2...&#39;&#39; and values are</span>
<span class="sd">            another dicts, where keys are atomic symbols, values are indicies,</span>
<span class="sd">            as they appear in the :literal:`*.yaml` file,</span>

<span class="sd">            e.g. ``&#39;OH&#39;`` for ``&#39;H + O -&gt; OH&#39;``</span>

<span class="sd">            &gt;&gt;&gt; all_reacting_atoms = {&#39;O&#39;: 0, &#39;H&#39;: 1}</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">all_reacting_atoms</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">reactions</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">open_yaml_file</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reactions</span><span class="p">):</span>
            <span class="n">r_name_list</span><span class="p">,</span> <span class="n">p_name_list</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_reactants_and_products</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_name_list</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_name_list</span><span class="p">):</span>
                <span class="n">easier_to_build</span> <span class="o">=</span> <span class="s1">&#39;reactant&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">easier_to_build</span> <span class="o">=</span> <span class="s1">&#39;product&#39;</span>

            <span class="n">reacting_species_connectivity</span> <span class="o">=</span> <span class="n">rxn</span><span class="p">[</span><span class="n">easier_to_build</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">reacting_atoms_and_idxs</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_reacting_atoms_idx_dict</span><span class="p">(</span>
                <span class="n">reacting_species_connectivity</span><span class="p">)</span>
            <span class="n">all_reacting_atoms</span><span class="p">[</span><span class="s1">&#39;rxn_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">)]</span> <span class="o">=</span> <span class="n">reacting_atoms_and_idxs</span>
        <span class="k">return</span> <span class="n">all_reacting_atoms</span></div>

<div class="viewcode-block" id="IO.get_reacting_atoms_idx_dict"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_reacting_atoms_idx_dict">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_reacting_atoms_idx_dict</span><span class="p">(</span>
            <span class="n">reacting_species_connectivity</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; Get a dict with atomic symbols and indicies of reacting atoms -</span>
<span class="sd">        the one with asterisk in the :literal:`*.yaml` file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reacting_species_connectivity : List[str]</span>
<span class="sd">            conectivity info for the species that is easier to use as a</span>
<span class="sd">            TS guess skeleton</span>

<span class="sd">            e.g. ``&#39;OH&#39;`` for ``&#39;H + O -&gt; OH&#39;``</span>

<span class="sd">            &gt;&gt;&gt; reacting_species_connectivity = [&#39;multiplicity -187&#39;,</span>
<span class="sd">                                                &#39;1 *1 O u0 p0 c0 {2,S} {4,S}&#39;,</span>
<span class="sd">                                                &#39;2 *2 H u0 p0 c0 {1,S}&#39;,</span>
<span class="sd">                                                &#39;3 *3 X u0 p0 c0&#39;,</span>
<span class="sd">                                                &#39;4    X u0 p0 c0 {1,S}&#39;,</span>
<span class="sd">                                                &#39;&#39;]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reacting_idxs = Dict[str, int]</span>
<span class="sd">            keys are atomic symbols, values are indicies, as they appear in the</span>
<span class="sd">            :literal:`*.yaml` file,</span>
<span class="sd">            e.g. ``&#39;OH&#39;`` for ``&#39;H + O -&gt; OH&#39;``</span>

<span class="sd">            &gt;&gt;&gt; reacting_idxs = {&#39;O&#39;: 0, &#39;H&#39;: 1}</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">reacting_idxs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">n_surf_at_befor_ads</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">remove_one_more</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reacting_species_connectivity</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;multiplicity&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s1">&#39;X&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">n_surf_at_befor_ads</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reacting_species_connectivity</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;multiplicity&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">remove_one_more</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;X&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">atom_symbol</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">reacting_idxs</span><span class="p">[</span><span class="n">atom_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">num</span> <span class="o">-</span> <span class="n">n_surf_at_befor_ads</span> <span class="o">-</span> <span class="n">remove_one_more</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reacting_idxs</span></div>

<div class="viewcode-block" id="IO.get_TS_guess_image"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_TS_guess_image">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_TS_guess_image</span><span class="p">(</span>
            <span class="n">rxn</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
            <span class="n">easier_to_build</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Gratoms</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39; Convert RMGCat representation of species to Gratom object</span>
<span class="sd">        - the case of TS_guess</span>

<span class="sd">        .. todo:: There is only one element for every reaction tested. |br| There will be a problem for AX + BX -&gt; CX + DX</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rxn : Dict[str, str]</span>
<span class="sd">            a dictionary with info about the paricular reaction. This can be</span>
<span class="sd">            view as a splitted many reaction .yaml file to a single reaction</span>
<span class="sd">            :literal:`*.yaml` file</span>
<span class="sd">        easier_to_build : str</span>
<span class="sd">            a list of species that are considerd as the reactiong one</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ts_guess_image : Gratoms</span>
<span class="sd">            Skeleton of an TS that is used to generate TS_guesses in</span>
<span class="sd">            :meth:`pynta.general_ts_guesses.decide`</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ts_guess</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">rmgcat_to_gratoms</span><span class="p">(</span>
            <span class="n">rxn</span><span class="p">[</span><span class="n">easier_to_build</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">ts_guess_image</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span><span class="o">.</span><span class="n">get_3D_positions</span><span class="p">(</span><span class="n">ts_guess</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ts_guess_image</span></div>

<div class="viewcode-block" id="IO.get_all_unique_images_with_bonds"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_all_unique_images_with_bonds">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_all_unique_images_with_bonds</span><span class="p">(</span>
            <span class="n">yamlfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gratoms</span><span class="p">]]:</span>
        <span class="sd">&#39;&#39;&#39; Return a list with all unique images (Gratoms) for all reactions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yamlfile : str a name of the :literal:`*.yaml` file with a reaction</span>
<span class="sd">            list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        all_images_with_bonds : Dict[int, Dict[int, Gratoms]] a Dict with all</span>
<span class="sd">            unique Gratoms objects for all reactions together with information</span>
<span class="sd">            which atoms connects Gratoms object to the surface</span>


<span class="sd">        &gt;&gt;&gt; all_images_with_bonds =</span>
<span class="sd">            {</span>
<span class="sd">             0: {0: Gratoms(symbols=&#39;OH&#39;, pbc=False, tags=...)},</span>
<span class="sd">             1: {0: Gratoms(symbols=&#39;O&#39;, pbc=False, tags=...)},</span>
<span class="sd">             2: {0: Gratoms(symbols=&#39;H&#39;, pbc=False, tags=...)},</span>
<span class="sd">             3: {0: Gratoms(symbols=&#39;OCH2OCH2&#39;, pbc=False, tags=...)},</span>
<span class="sd">             4: {0: Gratoms(symbols=&#39;OCH3&#39;, pbc=False, tags=...)},</span>
<span class="sd">             5: {1: Gratoms(symbols=&#39;OCH&#39;, pbc=False, tags=...)},</span>
<span class="sd">             6: {0: Gratoms(symbols=&#39;OHCH&#39;, pbc=False, tags=...)}</span>
<span class="sd">            }</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">reactions</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">open_yaml_file</span><span class="p">(</span><span class="n">yamlfile</span><span class="p">)</span>

        <span class="n">all_images_unique</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_images</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">reactions</span><span class="p">:</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_images</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span>
            <span class="n">all_images</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>

        <span class="c1"># check if any species in one reaction is the same as any species</span>
        <span class="c1"># in the other reaction</span>
        <span class="n">unique_bonds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">bonded_dict</span> <span class="ow">in</span> <span class="n">all_images</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">bond</span><span class="p">,</span> <span class="n">gratoms1</span> <span class="ow">in</span> <span class="n">bonded_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">gratoms2</span> <span class="ow">in</span> <span class="n">all_images_unique</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_isomorphic</span><span class="p">(</span>
                            <span class="n">gratoms1</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">gratoms2</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">node_test</span><span class="p">):</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unique_bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
                    <span class="n">all_images_unique</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gratoms1</span><span class="p">)</span>

        <span class="n">all_images_with_bonds</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">uq_image</span><span class="p">,</span> <span class="n">bond</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_images_unique</span><span class="p">,</span> <span class="n">unique_bonds</span><span class="p">):</span>
            <span class="n">all_images_with_bonds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">bond</span><span class="p">:</span> <span class="n">uq_image</span><span class="p">}</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">all_images_with_bonds</span></div>

<div class="viewcode-block" id="IO.get_images"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_images">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_images</span><span class="p">(</span><span class="n">rxn</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gratoms</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; Convert RMGCat representation of species for a given rxn</span>
<span class="sd">        to a dict of Gratoms objects - both reactants and products combined.</span>

<span class="sd">        .. note:: Reactants or products can be symmetrically identical at this step.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rxn : Dict[str, str]</span>
<span class="sd">            a dictionary with info about the paricular reaction. This can be</span>
<span class="sd">            view as a splitted many reaction :literal:`*.yaml` file to a</span>
<span class="sd">            single reaction :literal:`*.yaml` file</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        images : List[Gratoms]</span>
<span class="sd">            a dict with all unique Gratoms object representing each species</span>
<span class="sd">            taking part in reaction rxn</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">species</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rxn_bonded_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">reag</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;reactant&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span><span class="p">]:</span>
            <span class="n">adjtxt_react</span> <span class="o">=</span> <span class="n">rxn</span><span class="p">[</span><span class="n">reag</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">reagent</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">rmgcat_to_gratoms</span><span class="p">(</span><span class="n">adjtxt_react</span><span class="p">)</span>
            <span class="n">reactant_bonded_idx</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_surface_bonded</span><span class="p">(</span><span class="n">adjtxt_react</span><span class="p">)</span>
            <span class="n">species</span> <span class="o">+=</span> <span class="n">reagent</span>
            <span class="n">bonded_dict_reactants</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">get_bonded_dict</span><span class="p">(</span>
                <span class="n">reagent</span><span class="p">,</span> <span class="n">reactant_bonded_idx</span><span class="p">)</span>
            <span class="n">rxn_bonded_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bonded_dict_reactants</span><span class="p">)</span>

        <span class="n">unique_species</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">images</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># check if any products are the same as any reactants</span>
        <span class="k">for</span> <span class="n">species1</span><span class="p">,</span> <span class="n">bond</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">rxn_bonded_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">species2</span> <span class="ow">in</span> <span class="n">unique_species</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nx</span><span class="o">.</span><span class="n">is_isomorphic</span><span class="p">(</span>
                        <span class="n">species1</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">species2</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">node_test</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span><span class="o">.</span><span class="n">get_3D_positions</span><span class="p">(</span><span class="n">species1</span><span class="p">)</span>
                <span class="n">images</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">species1</span><span class="o">.</span><span class="n">symbols</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="n">bond</span><span class="p">:</span> <span class="n">image</span><span class="p">}</span>
                <span class="n">unique_species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">species1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">images</span></div>

<div class="viewcode-block" id="IO.get_bonded_dict"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_bonded_dict">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_bonded_dict</span><span class="p">(</span>
            <span class="n">reactants</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Gratoms</span><span class="p">],</span>
            <span class="n">reactant_bonded_idx</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; Create a dict with bonding information for a specifc reaction and</span>
<span class="sd">        specific type of reagents (reactants or products)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reactants : List[Gratoms]</span>
<span class="sd">            a list gratoms objects</span>
<span class="sd">        reactant_bonded_idx : List[int]</span>
<span class="sd">            a list with indicies of atoms that are connected to the surface</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bonded_dict : Dict[str, int]</span>
<span class="sd">            a dictionary with keys being atomic symbols and values are indicies</span>
<span class="sd">            of atoms that connects to the surface. Indicies are folowing the</span>
<span class="sd">            order of atoms as in Gratoms objec</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">bonded_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reactants</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">reactant_bonded_idx</span><span class="p">:</span>
                <span class="n">bonded_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">symbols</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">reactant_bonded_idx</span><span class="p">:</span>
                    <span class="n">bonded_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">symbols</span><span class="p">)]</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">index</span>
        <span class="k">return</span> <span class="n">bonded_dict</span></div>

<div class="viewcode-block" id="IO.get_surface_bonded"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_surface_bonded">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_surface_bonded</span><span class="p">(</span><span class="n">adjtxt</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; For each reactant in adjtxt from :literal:`*.yaml` file, get info</span>
<span class="sd">        which atoms are connected to surface</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        adjtxt : List[str]</span>
<span class="sd">            a list with a connectivity info for reactant or product</span>
<span class="sd">            as from the .yaml file</span>

<span class="sd">            e.g. for given reaction (reactant or product)</span>

<span class="sd">            In :literal:`*.yaml` file we have something like that::</span>

<span class="sd">                    multiplicity -187</span>
<span class="sd">                1 *1 C u0 p0 c0 {2,S} {4,S}</span>
<span class="sd">                2    O u0 p0 c0 {1,S}</span>
<span class="sd">                3 *2 H u0 p0 c0 {5,S}</span>
<span class="sd">                4 *3 X u0 p0 c0 {1,S}</span>
<span class="sd">                5 *4 X u0 p0 c0 {3,S}</span>

<span class="sd">            but we need here a list like that:</span>

<span class="sd">            &gt;&gt;&gt; tmp_list = [&#39;multiplicity -187&#39;, &#39;1 *1 C u0 p0 c0 {2,S} {4,S}&#39;,</span>
<span class="sd">                            &#39;2    O u0 p0 c0 {1,S}&#39;, &#39;3 *2 H u0 p0 c0 {5,S}&#39;,</span>
<span class="sd">                            &#39;4 *3 X u0 p0 c0 {1,S}&#39;, &#39;5 *4 X u0 p0 c0 {3,S}&#39;,</span>
<span class="sd">                            &#39;&#39;]</span>

<span class="sd">            So it can be simply converted using the following:</span>

<span class="sd">            &gt;&gt;&gt; yamlfile = &#39;reactions.yaml&#39;</span>
<span class="sd">            &gt;&gt;&gt; with open(yamlfile, &#39;r&#39;) as f:</span>
<span class="sd">                    text = f.read()</span>
<span class="sd">            &gt;&gt;&gt; reactions = yaml.safe_load(text)</span>
<span class="sd">            &gt;&gt;&gt; for rxn in reactions:</span>
<span class="sd">                    adjtxt = rxn[&#39;reactant&#39;].split(&#39;\\n&#39;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        idx_surface_bonded_atoms : List[int]</span>
<span class="sd">            a list with indicies of atoms connected to the surface. Each index</span>
<span class="sd">            refers to a position of a atom in :literal:`*.yaml` file</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">n_surf_at_befor_ads</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s1">&#39;multiplicity&#39;</span> <span class="ow">in</span> <span class="n">adjtxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">start_idx</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">adjtxt</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s1">&#39;X&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">n_surf_at_befor_ads</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">inc</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
                <span class="n">inc</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">inc</span><span class="p">])</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">5</span> <span class="o">+</span> <span class="n">inc</span><span class="p">:]</span>

            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">conn</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">gratoms</span> <span class="o">=</span> <span class="n">Gratoms</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>

        <span class="n">del_indices</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gratoms</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">gratoms</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                    <span class="n">tags</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">del_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="n">gratoms</span><span class="o">.</span><span class="n">set_tags</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="n">idx_surface_bonded_atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span>
            <span class="n">gratoms</span><span class="o">.</span><span class="n">get_tags</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">idx_surface_bonded_atoms</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">idx</span> <span class="o">-</span> <span class="n">n_surf_at_befor_ads</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_surface_bonded_atoms</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">idx_surface_bonded_atoms</span></div>

<div class="viewcode-block" id="IO.rmgcat_to_gratoms"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.rmgcat_to_gratoms">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rmgcat_to_gratoms</span><span class="p">(</span>
            <span class="n">adjtxt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Gratoms</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; Convert a slice of :literal:`*.yaml` file to Catkit&#39;s Gratoms object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        adjtxt : List[str]</span>
<span class="sd">            a list with a connectivity info for reactant or product</span>
<span class="sd">            as from the .yaml file</span>

<span class="sd">            e.g. for given reaction (reactant or product)</span>

<span class="sd">            In :literal:`*.yaml` file we have something like that::</span>

<span class="sd">                    multiplicity -187</span>
<span class="sd">                1 *1 C u0 p0 c0 {2,S} {4,S}</span>
<span class="sd">                2    O u0 p0 c0 {1,S}</span>
<span class="sd">                3 *2 H u0 p0 c0 {5,S}</span>
<span class="sd">                4 *3 X u0 p0 c0 {1,S}</span>
<span class="sd">                5 *4 X u0 p0 c0 {3,S}</span>

<span class="sd">            but we need here a list like that:</span>

<span class="sd">            &gt;&gt;&gt; tmp_list = [&#39;multiplicity -187&#39;, &#39;1 *1 C u0 p0 c0 {2,S} {4,S}&#39;,</span>
<span class="sd">                            &#39;2    O u0 p0 c0 {1,S}&#39;, &#39;3 *2 H u0 p0 c0 {5,S}&#39;,</span>
<span class="sd">                            &#39;4 *3 X u0 p0 c0 {1,S}&#39;, &#39;5 *4 X u0 p0 c0 {3,S}&#39;,</span>
<span class="sd">                            &#39;&#39;]</span>

<span class="sd">            So it can be simply converted using the following:</span>

<span class="sd">            &gt;&gt;&gt; yamlfile = &#39;reactions.yaml&#39;</span>
<span class="sd">            &gt;&gt;&gt; with open(yamlfile, &#39;r&#39;) as f:</span>
<span class="sd">                    text = f.read()</span>
<span class="sd">            &gt;&gt;&gt; reactions = yaml.safe_load(text)</span>
<span class="sd">            &gt;&gt;&gt; for rxn in reactions:</span>
<span class="sd">                    adjtxt = rxn[&#39;reactant&#39;].split(&#39;\\n&#39;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gratoms_list : List[Gratoms]</span>
<span class="sd">            a list with all Gratoms objects for a give rxn</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s1">&#39;multiplicity&#39;</span> <span class="ow">in</span> <span class="n">adjtxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">start_idx</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">adjtxt</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">inc</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
                <span class="n">inc</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">inc</span><span class="p">])</span>
            <span class="n">conn</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">5</span> <span class="o">+</span> <span class="n">inc</span><span class="p">:]</span>

            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">conn</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bond</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">gratoms</span> <span class="o">=</span> <span class="n">Gratoms</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>

        <span class="n">del_indices</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gratoms</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">gratoms</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                    <span class="n">tags</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">del_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="n">gratoms</span><span class="o">.</span><span class="n">set_tags</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">gratoms</span><span class="p">[</span><span class="n">del_indices</span><span class="p">]</span>

        <span class="n">gratoms_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">graphs</span> <span class="o">=</span> <span class="p">[</span><span class="n">gratoms</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span>
            <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">gratoms</span><span class="o">.</span><span class="n">graph</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">subgraph</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">graphs</span><span class="p">):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subgraph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="n">gratoms</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">symbols</span>
            <span class="n">new_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">old</span><span class="p">:</span> <span class="n">new</span> <span class="k">for</span> <span class="n">new</span><span class="p">,</span> <span class="n">old</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">)}</span>
            <span class="n">new_edges</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                <span class="n">newa</span> <span class="o">=</span> <span class="n">new_indices</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">newb</span> <span class="o">=</span> <span class="n">new_indices</span><span class="p">[</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">new_edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">newa</span><span class="p">,</span> <span class="n">newb</span><span class="p">))</span>

            <span class="n">new_gratoms</span> <span class="o">=</span> <span class="n">Gratoms</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">new_edges</span><span class="p">)</span>

            <span class="n">tags</span> <span class="o">=</span> <span class="n">indices</span>
            <span class="n">new_gratoms</span><span class="o">.</span><span class="n">set_tags</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="n">gratoms_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_gratoms</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gratoms_list</span></div>

<div class="viewcode-block" id="IO.get_calculators"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.get_calculators">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_calculators</span><span class="p">(</span><span class="n">quantum_chemistry</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&#39;&#39;&#39; Get a proper names of quantum_chemistry calculators</span>
<span class="sd">        (socket and balsamsocket)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        quantum_chemistry : str</span>
<span class="sd">            a keyword describing which quantum chemistry package to use</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        calculator, socket_calculator : Tuple[str, str]</span>
<span class="sd">            well formated calculator and socket_calculator that refers to</span>
<span class="sd">            spefic method in :mod: balsamcalc</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            If not supported calculator was requested</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">quantum_chemistry</span> <span class="o">==</span> <span class="s1">&#39;espresso&#39;</span><span class="p">:</span>
            <span class="n">calculator</span> <span class="o">=</span> <span class="s1">&#39;EspressoBalsam&#39;</span>
        <span class="k">elif</span> <span class="n">quantum_chemistry</span> <span class="o">==</span> <span class="s1">&#39;nwchem&#39;</span><span class="p">:</span>
            <span class="n">calculator</span> <span class="o">=</span> <span class="s1">&#39;NWChemBalsam&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Pynta only supports the following &#39;</span>
                            <span class="s1">&#39;quantum chemistry packages (keywords): &#39;</span>
                            <span class="s1">&#39;   espresso&#39;</span>
                            <span class="s1">&#39;   nwchem&#39;</span><span class="p">)</span>
        <span class="n">socket_calculator</span> <span class="o">=</span> <span class="n">calculator</span> <span class="o">+</span> <span class="s1">&#39;SocketIO&#39;</span>

        <span class="k">return</span> <span class="n">calculator</span><span class="p">,</span> <span class="n">socket_calculator</span></div>

<div class="viewcode-block" id="IO.set_calculators"><a class="viewcode-back" href="../../source/pynta.html#pynta.io.IO.set_calculators">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_calculators</span><span class="p">(</span>
            <span class="n">executable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">calculator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">socket_calculator</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39; Create balsam socket and quantum chemistry calculator for requested</span>
<span class="sd">        quantum chemistry code</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        executable : str</span>
<span class="sd">            a path to system executable to python3</span>

<span class="sd">            &gt;&gt;&gt; executable = &#39;/Users/mgierad/opt/anaconda3/bin/python3&#39;</span>

<span class="sd">        calculator : str</span>
<span class="sd">            name of quantum chemistry calculator</span>
<span class="sd">        socket_calculator : str</span>
<span class="sd">            name of quantum chemistry calculator bundle with balsam\</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">balsamcalc_module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;pynta.balsamcalc&#39;</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span>
            <span class="n">socket_calculator</span><span class="p">])</span>

        <span class="n">calc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">balsamcalc_module</span><span class="p">,</span> <span class="n">calculator</span><span class="p">)</span>
        <span class="n">sock_calc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">balsamcalc_module</span><span class="p">,</span> <span class="n">socket_calculator</span><span class="p">)</span>

        <span class="n">calc</span><span class="o">.</span><span class="n">exe</span> <span class="o">=</span> <span class="n">executable</span>
        <span class="n">sock_calc</span><span class="o">.</span><span class="n">exe</span> <span class="o">=</span> <span class="n">executable</span>
        <span class="n">calc</span><span class="o">.</span><span class="n">create_application</span><span class="p">()</span>
        <span class="n">sock_calc</span><span class="o">.</span><span class="n">create_application</span><span class="p">()</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Copyright 2021 National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S. Government retains certain rights in this software..
      <span class="lastupdated">
        Last updated on Fri, 19 Feb 2021 11:33:53.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>